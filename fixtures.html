<!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8">
<title>Manage Fixtures</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* {
  box-sizing: border-box;
  user-select: none;
}
body {
  margin: 0;
  font-family: 'Arial', sans-serif;
  background: #121212;
  color: #f1f1f1;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}
.container {
  width: 100%;
  max-width: 400px;
}
form, .fixtures {
  background: #1e1e1e;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.6);
  margin-bottom: 20px;
}
label {
  display: block;
  margin-top: 12px;
  margin-bottom: 5px;
}
input, select, button {
  width: 100%;
  padding: 12px;
  border: none;
  border-radius: 8px;
  margin-bottom: 12px;
  background: #2a2a2a;
  color: #fff;
  font-size: 16px;
}
button {
  background: #007bff;
  font-weight: bold;
}
button:hover {
  background: #0056b3;
}
.fixture {
  background: #2a2a2a;
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 10px;
}
.fixture span {
  display: block;
  margin-bottom: 4px;
}
.move-btn {
  background: #28a745;
  margin-top: 8px;
}
.move-btn:hover {
  background: #1e7e34;
}
</style>
</head>
<body>
<div class="container">
  <h2 style="text-align:center">Add Fixture</h2>
  <form id="fixtureForm">
    <label>Team A (Owner)</label>
    <select id="teamASelect" required></select><label>Team B (Owner)</label>
<select id="teamBSelect" required></select>

<label>Fixture Date & Time</label>
<input type="datetime-local" id="fixtureDate" required>

<button type="submit">Add Fixture</button>

  </form>  <h2 style="text-align:center">Upcoming Fixtures</h2>
  <div class="fixtures" id="fixturesList"></div>
</div><script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
import { getDatabase, ref, set, get, onValue, remove } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
  authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
  databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
  projectId: "itzhoyoo-f9f7e",
  storageBucket: "itzhoyoo-f9f7e.appspot.com",
  messagingSenderId: "1094792075584",
  appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const teamASelect = document.getElementById('teamASelect');
const teamBSelect = document.getElementById('teamBSelect');
const fixtureForm = document.getElementById('fixtureForm');
const fixturesList = document.getElementById('fixturesList');

// Load available teams (not already in upcomingFixtures)
function loadTeams() {
  get(ref(db, 'users')).then(snapshot => {
    const allTeams = [];
    snapshot.forEach(child => {
      const data = child.val();
      allTeams.push({ username: data.username, team: data.team });
    });

    get(ref(db, 'upcomingfixtures')).then(fixSnap => {
      const usedTeams = [];
      fixSnap.forEach(fix => {
        const data = fix.val();
        usedTeams.push(data.teamA, data.teamB);
      });

      const available = allTeams.filter(t => !usedTeams.includes(t.team));

      [teamASelect, teamBSelect].forEach(select => {
        select.innerHTML = '<option value="">Select</option>';
        available.forEach(t => {
          const opt = document.createElement('option');
          opt.value = JSON.stringify(t);
          opt.textContent = `${t.team} (${t.username})`;
          select.appendChild(opt);
        });
      });
    });
  });
}

// Add fixture
fixtureForm.addEventListener('submit', e => {
  e.preventDefault();
  const a = JSON.parse(teamASelect.value);
  const b = JSON.parse(teamBSelect.value);
  const date = new Date(document.getElementById('fixtureDate').value).toISOString();
  const key = Date.now();

  if (a.team === b.team) {
    alert('Teams cannot be the same'); return;
  }

  set(ref(db, 'upcomingfixtures/' + key), {
    teamA: a.team,
    ownerA: a.username,
    teamB: b.team,
    ownerB: b.username,
    date: date
  }).then(() => {
    fixtureForm.reset();
    loadTeams();
  });
});

// Load fixtures and show buttons
function loadFixtures() {
  onValue(ref(db, 'upcomingfixtures'), snap => {
    fixturesList.innerHTML = '';
    const now = new Date();

    snap.forEach(child => {
      const key = child.key;
      const data = child.val();
      const fixtureEl = document.createElement('div');
      fixtureEl.className = 'fixture';
      const fixtureDate = new Date(data.date);

      fixtureEl.innerHTML = `
        <span><b>${data.teamA}</b> (${data.ownerA}) vs <b>${data.teamB}</b> (${data.ownerB})</span>
        <span>Date: ${fixtureDate.toLocaleString()}</span>
      `;

      if (fixtureDate < now) {
        const moveBtn = document.createElement('button');
        moveBtn.className = 'move-btn';
        moveBtn.textContent = 'Move to Previous';
        moveBtn.onclick = () => moveToPrevious(key, data);
        fixtureEl.appendChild(moveBtn);
      }

      fixturesList.appendChild(fixtureEl);
    });

    loadTeams();
  });
}

function moveToPrevious(key, data) {
  const prevRef = ref(db, 'previousfixtures/' + key);
  set(prevRef, data).then(() => {
    remove(ref(db, 'upcomingfixtures/' + key));
  });
}

loadTeams();
loadFixtures();
</script></body>
</html>