<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Homepage - Product Listing</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
    import { getDatabase, ref, set, push, get, child } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-database.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDFHskUWiyHhZke3KT9kkOtFI_gPsKfiGo",
      authDomain: "itzhoyoo-f9f7e.firebaseapp.com",
      databaseURL: "https://itzhoyoo-f9f7e-default-rtdb.firebaseio.com",
      projectId: "itzhoyoo-f9f7e",
      storageBucket: "itzhoyoo-f9f7e.firebasestorage.app",
      messagingSenderId: "1094792075584",
      appId: "1:1094792075584:web:d49e9c3f899d3cd31082a5",
      measurementId: "G-LLT6F9WRKH"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Function to fetch and display products
    function displayProducts() {
      const productsRef = ref(db, 'products');
      get(productsRef).then((snapshot) => {
        const productsContainer = document.getElementById('product-list');
        productsContainer.innerHTML = '';
        if (snapshot.exists()) {
          const products = snapshot.val();
          for (let key in products) {
            const product = products[key];
            const productElement = document.createElement('div');
            productElement.classList.add('bg-white', 'shadow', 'rounded-lg', 'p-4', 'mb-4');
            productElement.innerHTML = `
              <img src="${product.imageUrl}" alt="${product.name}" class="w-24 h-24 object-cover mb-2">
              <h3 class="text-lg font-semibold">${product.name}</h3>
              <p class="text-sm text-gray-500">$${product.price}</p>
              <a href="cart.html?productKey=${key}" class="mt-2 bg-green-600 text-white py-2 px-4 rounded-lg inline-block">Buy</a>
            `;
            productsContainer.appendChild(productElement);
          }
        } else {
          productsContainer.innerHTML = '<p>No products available.</p>';
        }
      }).catch((error) => {
        console.error(error);
      });
    }

    // Function to handle product form submission
    function addProduct(event) {
      event.preventDefault();
      const productName = document.getElementById('product-name').value;
      const productPrice = document.getElementById('product-price').value;
      const productImageUrl = document.getElementById('product-image').value;

      const newProductRef = push(ref(db, 'products'));
      set(newProductRef, {
        name: productName,
        price: productPrice,
        imageUrl: productImageUrl
      }).then(() => {
        alert('Product added successfully!');
        displayProducts();  // Refresh product list
      }).catch((error) => {
        console.error('Error adding product:', error);
      });
    }

    window.onload = function() {
      displayProducts();
    }
  </script>
</head>
<body class="bg-gray-50 text-gray-900">

  <div class="max-w-7xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-6">Available Products</h1>

    <!-- Product List -->
    <div id="product-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>

    <h2 class="text-2xl font-semibold mt-12">Add New Product</h2>
    <form id="add-product-form" class="mt-6" onsubmit="addProduct(event)">
      <div class="mb-4">
        <label for="product-name" class="block text-sm font-medium text-gray-700">Product Name</label>
        <input type="text" id="product-name" class="w-full border rounded px-4 py-2" required>
      </div>
      <div class="mb-4">
        <label for="product-price" class="block text-sm font-medium text-gray-700">Product Price</label>
        <input type="number" id="product-price" class="w-full border rounded px-4 py-2" required>
      </div>
      <div class="mb-4">
        <label for="product-image" class="block text-sm font-medium text-gray-700">Product Image URL</label>
        <input type="text" id="product-image" class="w-full border rounded px-4 py-2" required>
      </div>
      <button type="submit" class="bg-blue-600 text-white py-2 px-6 rounded-lg">Add Product</button>
    </form>
  </div>

</body>
</html>